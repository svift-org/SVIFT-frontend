var SVIFT={};SVIFT.helper={},SVIFT.helper.debouncer=function(t,e){var n,a=e||200;return function(){var e=this,o=arguments;clearTimeout(n),n=setTimeout(function(){t.apply(e,Array.prototype.slice.call(o))},a)}},SVIFT.helper.interpolate=function(t){var e,n={};for(n.def=t,n.interpolate=[],n.duration=0,e=1;n.def.length>e;e++)"ease"in n.def[e]||(n.def[e].ease=!1),n.interpolate.push(d3.interpolate(n.def[e-1].value,n.def[e].value)),n.duration+=n.def[e].duration;var a=0;for(e=1;n.def.length>e;e++)n.def[e].duration=n.def[e].duration/n.duration,n.def[e].start=a,a+=n.def[e].duration;return n.i=function(t){for(var e=1;n.def.length>e;e++)if(t>=n.def[e].start&&n.def[e].start+n.def[e].duration>=t)return n.def[e].ease?n.interpolate[e-1](n.def[e].ease((t-n.def[e].start)/n.def[e].duration)):n.interpolate[e-1]((t-n.def[e].start)/n.def[e].duration)},n.i},SVIFT.helper.switchCol=function(t,e,n){return t.forEach(function(t){var a=t[e];t[e]=t[n],t[n]=a}),t},SVIFT.helper.transpose=function(t){var e={};return t.forEach(function(t){for(var n in t)n in e||(e[n]=[])}),t.forEach(function(t){for(var n in e)n in t?e[n].push(t[n]):e[n].push(null)}),e},SVIFT.helper.cleanAxis=function(t){var e;e=t.attr("text-anchor")?t:t.select('g[text-anchor="*"]');var n=e.attr("text-anchor");e.selectAll("text").attr("text-anchor",n);var a=e.attr("font-size");e.selectAll("text").each(function(){var t=d3.select(this);["y","x"].forEach(function(e){var n=t.attr("d"+e);if(n){n.indexOf("em")>=0&&(n=parseFloat(n.substr(0,n.length-2))*a),t.attr("d"+e,0);var o=t.attr(e);o&&(n+=parseFloat(o)),t.attr(e,n)}})})},SVIFT.vis={},SVIFT.vis.base=function(t,e){var n={};return n.data=t,n.container=e,n.g=null,n.svg=null,n.config={maxWidth:4096,maxHeight:4096,margin:{top:20,right:20,bottom:20,left:20},font:{sizes:{1500:25,1000:20,0:16},"default":"14px"},paddingTopText:20,paddingBottomText:20},n.timeline={},n.init=function(){var e,a=n.container.node().offsetWidth;for(var o in n.config.font.sizes)a>=o&&(e=n.config.font.sizes[o]);n.svg=n.container.append("svg").attr("width","100%").attr("height","100%").attr("font-size",e).style("background-color","#ffffff"),n.defs=n.svg.append("defs"),n.g=n.svg.append("g").attr("transform","translate("+n.config.margin.top+","+n.config.margin.left+")"),n.config.topTextWrapper=n.g.append("g").attr("text-anchor","middle").attr("class","title-wrapper").attr("font-family",t.style.font),n.config.titleMain=n.config.topTextWrapper.append("text").text(t.data.title).attr("font-size","1.7em").attr("fill",t.style.color.main).attr("id","title-main"),n.config.titleSub=n.config.topTextWrapper.append("text").text(t.data.subTitle).attr("font-size","1em").attr("fill",t.style.color.second).attr("id","title-sub"),n.config.bottomTextWrapper=n.g.append("g").attr("font-family","InterfaceRegular"),n.config.attribution=n.config.bottomTextWrapper.append("text").text(t.data.attribution).attr("font-size",n.config.font.default).attr("fill",t.style.color.second).attr("font-style","italic"),n.config.source=n.config.bottomTextWrapper.append("text").text(t.data.source).attr("font-size",n.config.font.default).attr("fill",t.style.color.second).attr("id","source"),n.config.vizContainer=n.g.append("g").attr("class","viz-container"),n.playHead=0,n.setup(),n.resizeText(),n.resize();for(var o in n.timeline){var i=n.timeline[o];i.end>n.playTime&&(n.playTime=i.end)}n.time.step=n.playTime/(n.playTime/1e3*n.time.fps),"function"==typeof window.callPhantom&&window.callPhantom({msg:"setupDone"}),d3.select(window).on("resize",SVIFT.helper.debouncer(function(){n.resizeText(),n.resize()},200))},n.process=function(){},n.setup=function(){},n.update=function(){},n.resize=function(){},n.resizeText=function(){var t=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right,e=t/2;n.config.titleMain.attr("x",e).attr("y",function(){return n.config.titleMainHeight=this.getBBox().height,n.config.titleMainHeight}),n.config.titleSub.attr("x",e).attr("y",function(){return n.config.titleMainHeight+this.getBBox().height+10}),n.config.bottomTextWrapper.attr("transform","translate(0,"+(n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom)+")"),n.config.attribution.attr("x",function(){return t-this.getBBox().width}),n.config.source.attr("x",0),n.config.topTextHeight=n.config.topTextWrapper.node().getBBox().height+n.config.paddingTopText,n.config.bottomTextHeight=n.config.bottomTextWrapper.node().getBBox().height+n.config.paddingBottomText,n.config.vizContainer.attr("transform","translate(0,"+n.config.topTextHeight+")")},n.draw=function(t){for(var e in n.timeline){var a=n.timeline[e];t>=a.start&&a.end>=t?a.func((t-a.start)/(a.end-a.start)):t>a.end&&a.func(1)}},n.playHead=0,n.playState=!1,n.playTime=0,n.time={fps:30,step:0,elapsed:0,fpsInterval:1e3/30,then:0,startTime:0,now:0},n.play=function(){n.playState&&("function"==typeof window.callPhantom?(n.playHead+=n.time.step,n.playTime>=n.playHead?(n.draw(n.playHead),window.callPhantom({msg:"drawDone",playHead:n.playHead})):(n.playHead=n.playTime,n.draw(n.playHead),n.pause(),window.callPhantom({msg:"playDone"}))):(0===n.time.then&&(n.time.then=n.time.startTime=Date.now()),n.time.now=Date.now(),n.time.elapsed=n.time.now-n.time.then,n.playTime>=n.time.now-n.time.startTime?(window.requestAnimationFrame(n.play),n.time.elapsed>n.time.fpsInterval&&(n.time.then=n.time.now-n.time.elapsed%n.time.fpsInterval,n.playHead=n.time.now-n.time.startTime,n.draw(n.playHead))):(n.playHead=n.playTime,n.goTo(1),n.pause())))},n.start=function(){n.playState=!0,n.play()},n.pause=function(){n.playState=!1},n.goTo=function(t){n.playTime>=t&&(n.playHead=t*n.playTime,n.draw(n.playHead)),n.pause()},n},SVIFT.vis.columns=function(t,e){var n=SVIFT.vis.base(t,e);n.d3config={ease:d3.easeQuadOut,yInterpolate:[],hInterpolate:[],oInterpolate:[],steps:t.data.data.length,animation:{duration:3e3,barPartPercent:.8}},n.setup=function(){n.d3config.barsContainer=n.config.vizContainer.append("g").selectAll("g").data(t.data.data).enter().append("g"),n.d3config.bars=n.d3config.barsContainer.append("rect").style("stroke","transparent").style("fill",t.style.color.main),n.d3config.barsText=n.d3config.barsContainer.append("text").text(function(t){return t[0]}).attr("font-family",t.style.fontLables).attr("fill",t.style.color.second).attr("text-anchor","middle"),n.d3config.barsNumber=n.d3config.barsContainer.append("text").text(function(t){return t[1]}).attr("font-family",t.style.fontLables).attr("fill",t.style.color.second).attr("text-anchor","middle");for(var e=n.d3config.animation.duration*n.d3config.animation.barPartPercent,a=e/n.d3config.steps,o=0;n.d3config.steps>o;o++){var i=a*o-a/2;0==o&&(i=0);var r=a*(o+1);n.timeline["animationBar"+o]={start:i,end:r,func:n["drawBar"+o]}}for(var c=n.d3config.animation.duration-e,f=c/n.d3config.steps,o=0;n.d3config.steps>o;o++){var i=f*o-f/2+e;0==o&&(i=e);var r=f*(o+1)+e;n.timeline["animationBarText"+o]={start:i,end:r,func:n["drawBarLable"+o]}}},n.resize=function(){n.d3config.x=d3.scaleBand().padding(.1).domain(t.data.data.map(function(t){return t[0]})),n.d3config.y=d3.scaleLinear().domain([0,d3.max(t.data.data,function(t){return t[1]})]);var e=n.d3config.barsNumber._groups[0][0].getBBox().height,a=n.d3config.barsText._groups[0][0].getBBox().height,o=8,i=e+o;n.d3config.barsContainer.attr("transform","translate(0,"+i+")");var r=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right,c=n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom-n.config.bottomTextHeight-n.config.topTextHeight-e-a-i;n.d3config.x.range([0,r]),n.d3config.y.range([c,0]),n.d3config.bars.attr("x",function(t){return n.d3config.x(t[0])}).attr("width",n.d3config.x.bandwidth()).attr("opacity",0),n.d3config.barsText.attr("x",function(t){return n.d3config.x(t[0])+n.d3config.x.bandwidth()/2}).attr("y",function(){return this.getBBox().height+c+o}).attr("font-size","1em").attr("opacity",0),n.d3config.barsNumber.attr("x",function(t){return n.d3config.x(t[0])+n.d3config.x.bandwidth()/2}).attr("y",function(t){return n.d3config.y(t[1])-o}).attr("font-size","1em").attr("opacity",0),t.data.data.forEach(function(t,e){n.d3config.yInterpolate[e]=d3.interpolate(c,n.d3config.y(t[1])),n.d3config.hInterpolate[e]=d3.interpolate(0,c-n.d3config.y(t[1])),n.d3config.oInterpolate[e]=d3.interpolate(0,1)})};for(var a=function(t){return function(e){d3.select(n.d3config.bars._groups[0][t]).attr("y",function(){return n.d3config.yInterpolate[t](n.d3config.ease(e))}).attr("height",function(){return n.d3config.hInterpolate[t](n.d3config.ease(e))}).attr("opacity",function(){return n.d3config.oInterpolate[t](n.d3config.ease(e))})}},o=0;n.d3config.steps>o;o++)n["drawBar"+o]=a(o);for(var i=function(t){return function(e){d3.select(n.d3config.barsText._groups[0][t]).attr("opacity",function(){return n.d3config.oInterpolate[t](n.d3config.ease(e))}),d3.select(n.d3config.barsNumber._groups[0][t]).attr("opacity",function(){return n.d3config.oInterpolate[t](n.d3config.ease(e))})}},o=0;n.d3config.steps>o;o++)n["drawBarLable"+o]=i(o);return n},SVIFT.vis.count=function(t,e){var n=SVIFT.vis.base(t,e);return n.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0])},n.setup=function(){n.d3config.count=n.g.append("text").text(t.data.data[0]).attr("fill",t.style.color.main).attr("text-anchor","middle").attr("font-size",100).attr("opacity",0).attr("font-family",t.style.font)},n.resize=function(){var t=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right,e=n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom,a=e-n.config.topTextHeight-n.config.bottomTextHeight,o=Math.min(a,t);n.d3config.count.attr("x",t/2).attr("font-size",function(){var t=this.getBBox(),e=1.1*Math.min(t.width,t.height),a=d3.select(this).attr("font-size");return n.d3config.fatNumberNewSize=a*(o/e),n.d3config.fatNumberNewSize}).attr("opacity",1).attr("y",function(){return n.d3config.fatNumberNewSize+n.config.topTextHeight})},n.animateNumber=function(t){var e=Math.round(n.d3config.interpolate(n.d3config.ease(t)));n.d3config.count.text(e)},n.timeline={bars:{start:0,end:3e3,func:n.animateNumber}},n},SVIFT.vis.gooey=function(t,e){var n=SVIFT.vis.base(t,e);n.d3config={steps:t.data.data.length,allCirlcesInterpolation:d3.interpolate(0,t.data.data.length),ease:d3.easeCubicInOut,easeBigCircle:d3.easeExpInOut,sizes:function(){for(var e=[],n=0;t.data.data.length>n;n++)e.push(Math.sqrt(t.data.data[n][1]/Math.PI));return e}(),circleColorInterpolations:function(){for(var e=[],n=0;t.data.data.length>n;n++)e[n]=d3.scaleLinear().domain([0,1]).range([d3.rgb(t.style.color.dataColors[n]),d3.rgb(t.style.color.dataColors[n+1])]),n==t.data.data.length-1&&(e[n]=d3.scaleLinear().domain([0,1]).range([d3.rgb(t.style.color.dataColors[n]),d3.rgb(t.style.color.dataColors[n])]));return e}(),animation:{duration:6e3,gooeyPercent:.85}},n.setup=function(){n.d3config.gooeyContainer=n.g.append("g").style("filter","url(#gooey)"),n.d3config.filter=n.d3config.gooeyContainer.append("filter").attr("id","gooey"),n.d3config.filter.append("feGaussianBlur").attr("in","SourceGraphic").attr("stdDeviation","10").attr("result","blur"),n.d3config.filter.append("feColorMatrix").attr("in","blur").attr("mode","matrix").attr("values","1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7"),n.d3config.circles=n.d3config.gooeyContainer.selectAll("circle").data(t.data.data).enter().append("circle").attr("cx",0).attr("cy",0).style("fill",function(e,n){return t.style.color.dataColors[n]});for(var e=n.d3config.animation.duration*n.d3config.animation.gooeyPercent,a=e/n.d3config.steps,o=0;n.d3config.steps>o;o++)n.timeline["animation"+o]={start:a*o,end:a*(o+1),func:n["animate"+o]};for(var i=n.d3config.animation.duration-e,r=i/n.d3config.steps,o=0;n.d3config.steps>o;o++){var c=r*o+e;0==o&&(c=e);var f=r*(o+1)+e;n.timeline["animationBarText"+o]={start:c,end:f,func:n["drawBarLable"+o]}}n.d3config.centerCircle=n.d3config.gooeyContainer.append("circle").attr("class","centerCircle").attr("cx",0).attr("cy",0),n.d3config.bubbleLables=n.g.append("g").selectAll("text").data(t.data.data).enter().append("text").text(function(t){return t[0]+" - "+t[1]}).attr("fill",t.style.color.second).attr("text-anchor","middle").attr("opacity",0).attr("font-family",t.style.fontLables)},n.resize=function(){var e=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right,a=n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom,o=Math.min(e,a);n.d3config.xScale=d3.scaleLinear().domain([-1.7,1.7]).range([-o/2,o/2]),n.d3config.gooeyContainer.attr("transform","translate("+e/2+","+a/2+")");var i=d3.range(n.d3config.steps).map(function(t){return t/n.d3config.steps*2*Math.PI});n.d3config.cyInterpolation=[],n.d3config.cxInterpolation=[];for(var r=0;i.length>r;r++){var c=n.d3config.xScale(Math.sin(i[r]));n.d3config.cyInterpolation.push(d3.interpolate(0,c));var f=n.d3config.xScale(Math.cos(i[r]));n.d3config.cxInterpolation.push(d3.interpolate(0,f))}for(var d=o/10,l=d3.interpolate(0,d),s=Math.max.apply(Math,n.d3config.sizes),g=[],r=0;n.d3config.steps>r;r++)g.push(l(n.d3config.sizes[r]/s));n.d3config.circles.attr("r",function(t,e){return g[e]});for(var p=0,r=0;n.d3config.steps>r;r++){var u=Math.PI*Math.pow(g[r],2);p+=u}var m=[];m.push(p);for(var r=0;n.d3config.steps>r;r++){var u=Math.PI*Math.pow(g[r],2);p-=u,m[r+1]=p}m[m.length-1]=0,largerCircleInterpolations=[];for(var r=0;n.d3config.steps>r;r++)largerCircleInterpolations.push(d3.interpolate(Math.sqrt(m[r]/Math.PI),Math.sqrt(m[r+1]/Math.PI)));n.d3config.centerCircle=n.d3config.gooeyContainer.append("circle").attr("r",largerCircleInterpolations[0](0)).style("fill",t.style.color.dataColors[0]),n.d3config.bubbleLables.attr("dx",function(t,a){return n.d3config.cxInterpolation[a](1)+e/2}).attr("dy",function(t,e){return n.d3config.cyInterpolation[e](1)+a/2+g[e]+1.1*this.getBBox().height}).attr("font-size","0.8em")};for(var a=function(t){return function(e){d3.select(n.d3config.circles._groups[0][t]).attr("cy",n.d3config.cyInterpolation[t](n.d3config.ease(e))).attr("cx",n.d3config.cxInterpolation[t](n.d3config.ease(e))),n.d3config.centerCircle.attr("r",largerCircleInterpolations[t](n.d3config.easeBigCircle(e))).style("fill",n.d3config.circleColorInterpolations[t](n.d3config.ease(e)))}},o=function(t){return function(){d3.select(n.d3config.bubbleLables._groups[0][t]).attr("opacity",1)}},i=0;n.d3config.steps>i;i++)n["animate"+i]=a(i),n["drawBarLable"+i]=o(i);return n},SVIFT.vis.mosaic=function(t,e){var n=SVIFT.vis.base(t,e);return n.d3config={ease:d3.easeCubicInOut,interpolate:d3.interpolate(0,t.data.data[0])},n.gridSetupData=function(t){var e=.1*t;t-=e;for(var n=Array(),a=1,o=1,i=0;10>i;i++){n.push(Array());for(var r=0;10>r;r++)n[i].push({x:a,y:o,width:t,height:t}),a+=t+e;a=1,o+=t+e}return n},n.setup=function(){var e=n.gridSetupData(10);n.d3config.rowContainer=n.g.append("g").attr("id","rowContainer"),n.d3config.row=n.d3config.rowContainer.selectAll(".row").data(e).enter().append("g").attr("class","row"),n.d3config.column=n.d3config.row.selectAll(".square").data(function(t){return t}).enter().append("rect").attr("class","square").style("fill",t.style.color.second).style("stroke","#fff"),n.d3config.mosaicValueText=n.g.append("text").text(t.data.data[0]+"%").attr("font-family",t.style.font).attr("fill",t.style.color.main).attr("text-anchor","middle")},n.resize=function(){var t=n.container.node().offsetWidth-n.config.margin.left-n.config.margin.right,e=n.container.node().offsetHeight-n.config.margin.top-n.config.margin.bottom;n.d3config.mosaicValueText.attr("x",t/2).attr("font-size","2.5em");var a=n.config.bottomTextHeight+n.config.topTextHeight+n.d3config.mosaicValueText.node().getBBox().height+20,o=Math.min(t,e-a),i=o/10,r=n.gridSetupData(i);n.d3config.row.data(r).enter(),n.d3config.column.data(function(t){return t}).enter(),n.d3config.column.attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}),n.d3config.rowContainer.attr("transform","translate("+(t-o)/2+","+n.config.topTextHeight+")");var c=n.d3config.rowContainer.node().getBBox().height;n.d3config.mosaicValueText.attr("y",c+n.config.topTextHeight+n.config.margin.left+n.config.margin.right+20)},n.drawBars=function(e){var a=Math.round(n.d3config.interpolate(n.d3config.ease(e)));d3.selectAll("rect").filter(function(t,e){return a-1>=e}).style("fill",t.style.color.main),n.d3config.mosaicValueText.text(a+"%")},n.timeline={bars:{start:0,end:3e3,func:n.drawBars}},n};